//
//  JFTTableViewController.m
//  AsynDisplayLabel-objc
//
//  Created by jft0m on 2017/8/24.
//  Copyright Â© 2017å¹´ jft0m. All rights reserved.
//

#import "JFTTableViewController.h"
#import "JFTAsyncTextLabel.h"

@interface JFTCell : UITableViewCell
@property (nonatomic, strong) JFTAsyncTextLabel *ayncLabel;
@end

@implementation JFTCell

- (instancetype)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier {
    if (self = [super initWithStyle:style reuseIdentifier:reuseIdentifier]) {
        _ayncLabel = [JFTAsyncTextLabel new];
        [self.contentView addSubview:_ayncLabel];
    }
    return self;
}

- (void)layoutSubviews {
    [super layoutSubviews];
    self.ayncLabel.frame = self.contentView.bounds;
}

- (void)prepareForReuse {
    [super prepareForReuse];
    _ayncLabel.attributeString = nil;
}

@end

@interface JFTTableViewController ()
@property (nonatomic, strong) NSMutableArray *dataSource;
@end

@implementation JFTTableViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    self.dataSource = @[].mutableCopy;
    for (int i = 0 ; i < 100 ; i ++ ) {
        [self.dataSource addObject:[self creaAttributeString:i]];
    }
    [self.tableView registerClass:[JFTCell class] forCellReuseIdentifier:@"cell"];
    [self.tableView reloadData];
}

#pragma mark - Table view data source

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return self.dataSource.count;
}

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    JFTCell *cell = [tableView dequeueReusableCellWithIdentifier:@"cell" forIndexPath:indexPath];
    cell.ayncLabel.attributeString = self.dataSource[indexPath.row];

    return cell;
}

- (NSAttributedString *)creaAttributeString:(NSInteger)index {
    NSDictionary *dic = @{NSFontAttributeName : [UIFont systemFontOfSize:16.f]};
    return [[NSAttributedString alloc] initWithString:[NSString stringWithFormat:@"ã€%@ã€‘â€œåœç»ã€‚ä»Žåäº”å²å¼€å§‹çš„å¥³æ€§ç‰¹å¾å·²ç»ç»“æŸäº†ã€‚æˆ‘æ²¡æƒ³åˆ°è¿™ä¸€å¤©ä¼šæ¥å¾—è¿™ä¹ˆå¿«ï¼Œæˆ‘çš„èº«ä½“å·²ç»ä¸æ˜¯å¥³æ€§äº†å—ï¼Ÿä½ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåªæ˜¯åƒé¥±ç¡ã€ç¡é¥±åƒçš„ä¸‘é™‹æ€ªç‰©å—?\næˆ‘ç»ˆäºŽå¯ä»¥èµ°è·¯äº†ï¼Œæ‰€ä»¥å°±åŽ»ä¾¿åˆ©å•†åº—ã€‚æˆ‘ä¹°äº†å¾ˆå¤šä¾¿å½“å’Œä¸‰æ˜Žæ²»ï¼Œå¸¦å›žå®¶åŽåœ¨ä¸€å¤©ä¹‹å†…åƒå…‰å…‰ï¼Œè¿™æ‰çŸ¥é“å¤§å¿«æœµé¢çœŸæ˜¯å¿«ä¹ã€‚\næ¯å¤©ç¡è§‰å‰æˆ‘è¿˜æ˜¯è¦ä¾è€é…’ç²¾ï¼Œä¹Ÿå°±æ˜¯å¨å£«å¿Œã€‚äººçš„å¿ƒæƒ…è¶Šæ˜¯ä¸å¥½å°±è¶Šè§‰å¾—æ—¶é—´è¿‡å¾—å¾ˆå¿«ã€‚æ™šä¸Šåœ¨æ¯å­é‡Œå€’æ»¡å¨å£«å¿Œä¸€é¥®è€Œä¸‹åŽï¼Œæˆ‘å°±å€’åœ¨è¢«çªé‡Œï¼Œä¸‹ä¸€æ¬¡æ¸…é†’æ—¶åˆæ˜¯æ™šä¸Šäº†ï¼Œç„¶åŽæˆ‘åˆå‡†å¤‡è¦åœ¨æ¯å­é‡Œå€’å¨å£«å¿Œã€‚ä»¥ä¸ºçŽ°åœ¨æ‰åä¸€æœˆï¼Œä½†ä¸çŸ¥ä»€ä¹ˆæ—¶å€™å·²ç»æ˜¯åœ£è¯žèŠ‚äº†ã€‚ç­‰æˆ‘å‘çŽ°æ—¶ï¼Œæ˜­å’Œæ—¶æœŸä¹Ÿå·²ç»“æŸï¼Œæ¨±èŠ±ä¹Ÿå¼€äº†ã€‚æ‰åˆšè§‰å¾—æ¢…é›¨å­£èŠ‚æ¹¿ç­”\n:-Dâ€œç¬¬äºŒå¤©ï¼Œå½“æˆ‘æ­£æ‰“ç®—å‡ºåŽ»ä¹°ä¸€ç“¶æ–°çš„å¨å£«å¿Œæ—¶ï¼Œä¸€åªçŒ«ä»Žæˆ‘çš„å‰æ–¹æ¨ªè¶Šè¿‡åŽ»ï¼Œæˆ‘åœä¸‹è„šæ­¥ï¼Œæ— æ³•åŠ¨å¼¹ã€‚ä¸ºä»€ä¹ˆæˆ‘ä¼šæ€•çŒ«å‘¢ï¼Ÿæˆ‘è‡ªå·±ä¹Ÿæ— æ³•ç†è§£ã€‚ä¸åªæ˜¯çŒ«ï¼Œåªè¦ä¹Œé¸¦ä¸€å«ï¼Œæˆ‘å°±ä¼šæŠ±ç€å¤´è¹²ä¸‹æ¥ã€‚èº«åŽåªè¦æœ‰å£°éŸ³ï¼Œæˆ‘å°±ä¼šå‘å‡ºå°–å«ï¼Œç«‹åˆ»å›žåˆ°æˆ‘çš„æˆ¿é—´ï¼Œå°†çª—å¸˜æ‹‰ä¸Šï¼Œåœ¨å…¨é»‘çš„æˆ¿é—´é‡ŒæŠ±è†åç€ã€‚ä¸çŸ¥ä¸è§‰é—´æ•°ç€è‡ªå·±çš„å¿ƒè·³ï¼Œç»“æžœå¿ƒè·³è¶Šæ¥è¶Šå¿«ï¼Œå¤´å‘ä¹Ÿç«–ç«‹èµ·æ¥ã€‚æˆ‘è§‰å¾—å¿ƒè„è¦åœä¸‹æ¥äº†ï¼Œæˆ‘çœŸçš„æ˜¯è¿™æ ·è®¤ä¸ºã€‚æˆ‘æ‹¼å‘½ç¥·å‘Šï¼Œè®©å¿ƒè„ç»§ç»­è·³åŠ¨ï¼Œå¦‚æžœæˆ‘æ²¡æœ‰æ„Ÿè§‰åˆ°å¿ƒè·³ï¼Œå°±ä¼šæ‹…å¿ƒå¾—è¦ç–¯æŽ‰ä¼¼çš„ï¼Œæ€Žä¹ˆæ ·ä¹Ÿé™ä¸ä¸‹æ¥ï¼Œç„¶åŽçªç„¶å¤§å‘é›·éœ†ã€‚\nç”°æ‰€ï¼Œä¸ºä»€ä¹ˆä½ æƒ³éžç¤¼æˆ‘ï¼Ÿä¸ºä»€ä¹ˆä½ è¦æŠŠæˆ‘èµ¶å‡ºå­¦æ ¡ï¼Ÿ\nä½ä¼¯ï¼Œä¸ºä»€ä¹ˆä½ ä¸ä¿æŠ¤æˆ‘ï¼Ÿ\n å½»ä¹Ÿï¼Œä¸ºä»€ä¹ˆä½ ä¸å¸¦[â€¦]\n\nåœç»ã€‚ä»Žåäº”å²å¼€å§‹çš„å¥³æ€§ç‰¹å¾å·²ç»ç»“æŸäº†ã€‚æˆ‘æ²¡æƒ³åˆ°è¿™ä¸€å¤©ä¼šæ¥å¾—è¿™ä¹ˆå¿«ï¼Œæˆ‘çš„èº«ä½“å·²ç»ä¸æ˜¯å¥³æ€§äº†å—ï¼Ÿä½ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåªæ˜¯åƒé¥±ç¡ã€ç¡é¥±åƒçš„ä¸‘é™‹æ€ªç‰©å—?\næˆ‘ç»ˆäºŽå¯ä»¥èµ°è·¯äº†ï¼Œæ‰€ä»¥å°±åŽ»ä¾¿åˆ©å•†åº—ã€‚æˆ‘ä¹°äº†å¾ˆå¤šä¾¿å½“å’Œä¸‰æ˜Žæ²»ï¼Œå¸¦å›žå®¶åŽåœ¨ä¸€å¤©ä¹‹å†…åƒå…‰å…‰ï¼Œè¿™æ‰çŸ¥é“å¤§å¿«æœµé¢çœŸæ˜¯å¿«ä¹ã€‚\næ¯å¤©ç¡è§‰å‰æˆ‘è¿˜æ˜¯è¦ä¾è€é…’ç²¾ï¼Œä¹Ÿå°±æ˜¯å¨å£«å¿Œã€‚äººçš„å¿ƒæƒ…è¶Šæ˜¯ä¸å¥½å°±è¶Šè§‰å¾—æ—¶é—´è¿‡å¾—å¾ˆå¿«ã€‚æ™šä¸Šåœ¨æ¯å­é‡Œå€’æ»¡å¨å£«å¿Œä¸€é¥®è€Œä¸‹åŽï¼Œæˆ‘å°±å€’åœ¨è¢«çªé‡Œï¼Œä¸‹ä¸€æ¬¡æ¸…é†’æ—¶åˆæ˜¯æ™šä¸Šäº†ï¼Œç„¶åŽæˆ‘åˆå‡†å¤‡è¦åœ¨æ¯å­é‡Œå€’å¨å£«å¿Œã€‚ä»¥ä¸ºçŽ°åœ¨æ‰åä¸€æœˆï¼Œä½†ä¸çŸ¥ä»€ä¹ˆæ—¶å€™å·²ç»æ˜¯åœ£è¯žèŠ‚äº†ã€‚ç­‰æˆ‘å‘çŽ°æ—¶ï¼Œæ˜­å’Œæ—¶æœŸä¹Ÿå·²ç»“æŸï¼Œæ¨±èŠ±ä¹Ÿå¼€äº†ã€‚æ‰åˆšè§‰å¾—æ¢…é›¨å­£èŠ‚æ¹¿ç­”\n:-Dâ€œðŸ’ðŸ‚â€œåœç»ã€‚ä»Žåäº”å²å¼€å§‹çš„å¥³æ€§ç‰¹å¾å·²ç»ç»“æŸäº†ã€‚æˆ‘æ²¡æƒ³åˆ°è¿™ä¸€å¤©ä¼šæ¥å¾—è¿™ä¹ˆå¿«ï¼Œæˆ‘çš„èº«ä½“å·²ç»ä¸æ˜¯å¥³æ€§äº†å—ï¼Ÿä½ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåªæ˜¯åƒé¥±ç¡ã€ç¡é¥±åƒçš„ä¸‘é™‹æ€ªç‰©å—?\næˆ‘ç»ˆäºŽå¯ä»¥èµ°è·¯äº†ï¼Œæ‰€ä»¥å°±åŽ»ä¾¿åˆ©å•†åº—ã€‚æˆ‘ä¹°äº†å¾ˆå¤šä¾¿å½“å’Œä¸‰æ˜Žæ²»ï¼Œå¸¦å›žå®¶åŽåœ¨ä¸€å¤©ä¹‹å†…åƒå…‰å…‰ï¼Œè¿™æ‰çŸ¥é“å¤§å¿«æœµé¢çœŸæ˜¯å¿«ä¹ã€‚\næ¯å¤©ç¡è§‰å‰æˆ‘è¿˜æ˜¯è¦ä¾è€é…’ç²¾ï¼Œä¹Ÿå°±æ˜¯å¨å£«å¿Œã€‚äººçš„å¿ƒæƒ…è¶Šæ˜¯ä¸å¥½å°±è¶Šè§‰å¾—æ—¶é—´è¿‡å¾—å¾ˆå¿«ã€‚æ™šä¸Šåœ¨æ¯å­é‡Œå€’æ»¡å¨å£«å¿Œä¸€é¥®è€Œä¸‹åŽï¼Œæˆ‘å°±å€’åœ¨è¢«çªé‡Œï¼Œä¸‹ä¸€æ¬¡æ¸…é†’æ—¶åˆæ˜¯æ™šä¸Šäº†ï¼Œç„¶åŽæˆ‘åˆå‡†å¤‡è¦åœ¨æ¯å­é‡Œå€’å¨å£«å¿Œã€‚ä»¥ä¸ºçŽ°åœ¨æ‰åä¸€æœˆï¼Œä½†ä¸çŸ¥ä»€ä¹ˆæ—¶å€™å·²ç»æ˜¯åœ£è¯žèŠ‚äº†ã€‚ç­‰æˆ‘å‘çŽ°æ—¶ï¼Œæ˜­å’Œæ—¶æœŸä¹Ÿå·²ç»“æŸï¼Œæ¨±èŠ±ä¹Ÿå¼€äº†ã€‚æ‰åˆšè§‰å¾—æ¢…é›¨å­£èŠ‚æ¹¿ç­”\n:-Dâ€œç¬¬äºŒå¤©ï¼Œå½“æˆ‘æ­£æ‰“ç®—å‡ºåŽ»ä¹°ä¸€ç“¶æ–°çš„å¨å£«å¿Œæ—¶ï¼Œä¸€åªçŒ«ä»Žæˆ‘çš„å‰æ–¹æ¨ªè¶Šè¿‡åŽ»ï¼Œæˆ‘åœä¸‹è„šæ­¥ï¼Œæ— æ³•åŠ¨å¼¹ã€‚ä¸ºä»€ä¹ˆæˆ‘ä¼šæ€•çŒ«å‘¢ï¼Ÿæˆ‘è‡ªå·±ä¹Ÿæ— æ³•ç†è§£ã€‚ä¸åªæ˜¯çŒ«ï¼Œåªè¦ä¹Œé¸¦ä¸€å«ï¼Œæˆ‘å°±ä¼šæŠ±ç€å¤´è¹²ä¸‹æ¥ã€‚èº«åŽåªè¦æœ‰å£°éŸ³ï¼Œæˆ‘å°±ä¼šå‘å‡ºå°–å«ï¼Œç«‹åˆ»å›žåˆ°æˆ‘çš„æˆ¿é—´ï¼Œå°†çª—å¸˜æ‹‰ä¸Šï¼Œåœ¨å…¨é»‘çš„æˆ¿é—´é‡ŒæŠ±è†åç€ã€‚ä¸çŸ¥ä¸è§‰é—´æ•°ç€è‡ªå·±çš„å¿ƒè·³ï¼Œç»“æžœå¿ƒè·³è¶Šæ¥è¶Šå¿«ï¼Œå¤´å‘ä¹Ÿç«–ç«‹èµ·æ¥ã€‚æˆ‘è§‰å¾—å¿ƒè„è¦åœä¸‹æ¥äº†ï¼Œæˆ‘çœŸçš„æ˜¯è¿™æ ·è®¤ä¸ºã€‚æˆ‘æ‹¼å‘½ç¥·å‘Šï¼Œè®©å¿ƒè„ç»§ç»­è·³åŠ¨ï¼Œå¦‚æžœæˆ‘æ²¡æœ‰æ„Ÿè§‰åˆ°å¿ƒè·³ï¼Œå°±ä¼šæ‹…å¿ƒå¾—è¦ç–¯æŽ‰ä¼¼çš„ï¼Œæ€Žä¹ˆæ ·ä¹Ÿé™ä¸ä¸‹æ¥ï¼Œç„¶åŽçªç„¶å¤§å‘é›·éœ†ã€‚\nç”°æ‰€ï¼Œä¸ºä»€ä¹ˆä½ æƒ³éžç¤¼æˆ‘ï¼Ÿä¸ºä»€ä¹ˆä½ è¦æŠŠæˆ‘èµ¶å‡ºå­¦æ ¡ï¼Ÿ\nä½ä¼¯ï¼Œä¸ºä»€ä¹ˆä½ ä¸ä¿æŠ¤æˆ‘ï¼Ÿ\n å½»ä¹Ÿï¼Œä¸ºä»€ä¹ˆä½ ä¸å¸¦[â€¦]\n\nåœç»ã€‚ä»Žåäº”å²å¼€å§‹çš„å¥³æ€§ç‰¹å¾å·²ç»ç»“æŸäº†ã€‚æˆ‘æ²¡æƒ³åˆ°è¿™ä¸€å¤©ä¼šæ¥å¾—è¿™ä¹ˆå¿«ï¼Œæˆ‘çš„èº«ä½“å·²ç»ä¸æ˜¯å¥³æ€§äº†å—ï¼Ÿä½ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåªæ˜¯åƒé¥±ç¡ã€ç¡é¥±åƒçš„ä¸‘é™‹æ€ªç‰©å—?\næˆ‘ç»ˆäºŽå¯ä»¥èµ°è·¯äº†ï¼Œæ‰€ä»¥å°±åŽ»ä¾¿åˆ©å•†åº—ã€‚æˆ‘ä¹°äº†å¾ˆå¤šä¾¿å½“å’Œä¸‰æ˜Žæ²»ï¼Œå¸¦å›žå®¶åŽåœ¨ä¸€å¤©ä¹‹å†…åƒå…‰å…‰ï¼Œè¿™æ‰çŸ¥é“å¤§å¿«æœµé¢çœŸæ˜¯å¿«ä¹ã€‚\næ¯å¤©ç¡è§‰å‰æˆ‘è¿˜æ˜¯è¦ä¾è€é…’ç²¾ï¼Œä¹Ÿå°±æ˜¯å¨å£«å¿Œã€‚äººçš„å¿ƒæƒ…è¶Šæ˜¯ä¸å¥½å°±è¶Šè§‰å¾—æ—¶é—´è¿‡å¾—å¾ˆå¿«ã€‚æ™šä¸Šåœ¨æ¯å­é‡Œå€’æ»¡å¨å£«å¿Œä¸€é¥®è€Œä¸‹åŽï¼Œæˆ‘å°±å€’åœ¨è¢«çªé‡Œï¼Œä¸‹ä¸€æ¬¡æ¸…é†’æ—¶åˆæ˜¯æ™šä¸Šäº†ï¼Œç„¶åŽæˆ‘åˆå‡†å¤‡è¦åœ¨æ¯å­é‡Œå€’å¨å£«å¿Œã€‚ä»¥ä¸ºçŽ°åœ¨æ‰åä¸€æœˆï¼Œä½†ä¸çŸ¥ä»€ä¹ˆæ—¶å€™å·²ç»æ˜¯åœ£è¯žèŠ‚äº†ã€‚ç­‰æˆ‘å‘çŽ°æ—¶ï¼Œæ˜­å’Œæ—¶æœŸä¹Ÿå·²ç»“æŸï¼Œæ¨±èŠ±ä¹Ÿå¼€äº†ã€‚æ‰åˆšè§‰å¾—æ¢…é›¨å­£èŠ‚æ¹¿ç­”\n:-Dâ€œðŸ“", @(index)] attributes:dic];
    
}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath {
    return 500;
}

@end
